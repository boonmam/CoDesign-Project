# CoDesign-Project
In this project, we connect to a YDLIDAR X2 sensor to collect LIDAR sensor. raw Lidar sensor is processed into groups and mean locations for objects are derived. A Kalman filter with constant velocity is used to track objects between frames.

This project is intended to implented on a PYNQ board, much of the data processing will exist on hardware.

This is a class project for EECE 4632 Hardware Software Codesign (Northeastern University).

## Project Update 1
 
 In this inital software implementation of the project, there are two python scripts. clusterProto.py is intended to connect to the YDLIDAR X2, record Lidar data as CSV files, and cluster the raw LIDAR data as objects.
 
 clusterProtoSim.py will playback the data and cluster the raw LIDAR sensor stored as CSV files.
 
 ### Description of Functions
 **clusterOps**
 
 Inputs - distance[list] and angle[list]
 Output - objects[set]
 
 Evaluate the point at the zero angle, determine the dsitance to the adjacent point. If the distance to the adjacent point is outside of threshold distance, move onto the next point. 
 
 If the distance IS within the threshold distance, add the adjacent point to the current cluster list, add point to a set of grouped points, and finally sets the adjacent point as point under test. Repeat test over remaining sample set. After all points have been tested, add the cluster list of the set of objects.
 
 Repeat tests for any points not already grouped into a cluster (check if point is in set of grouped points). Discard clusters that consist of 3 or less points. This in effect, crudely removes noise. Return set of objects. 
 

 
 **plotAll**
 
 Inputs - object[set], distance[list], and angle[list]

 This function calculates the mean distance and angle of each object.
 
 This function plots distance and angle on a polar subplot. In the other polar subplot, the function plots each object in different colors and all the mean location of objects.
  
 ### Running Demonstration of Project Update 1 (clusterProtoSim.py)
 1. Ensure LidarData in the same directory as clusterProtoSim.py
 2. Select Sample set (currently only Bedroom and LivingRoom)
 3. Lidar data will begin to playback (Data displays best if full screen)
 
 ## Project Update 2
The latest update involves the successful translation of the original Python code into C++ using Vivado HLS. The new implementation can handle AXI4-Stream input and output data. Additionally, a testbench has been developed to verify the accuracy of the new implementation using actual data. The results showed that the Vivado HLS implementation produced clusters similar to those generated by the Python software implementation.

A Jupyter Notebook has been created to read Lidar Data from a CSV file located in a data folder within the working directory. The data is then stored in an array. The notebook initializes a DMA interface to facilitate data transfer from the Processing System to the clustering function in the FPGA fabric. The clustering function returns an array of clusters. The integer 720 denotes the start of a new cluster. The notebook formats the data from the clusters into separate arrays.

 ### Running Demonstration of Project Update 2 (project_20230327.ipynb)
 1. Ensure a LIDAR csv file in a directory called "data" in the working directory
 2. Ensure the clusterOp Overlay files in a directory named "clusterOp" in the overlay folder
 3. The python notebook will return a series of clusters (as angles)
 
 ## Project Update 2.1 (After Deadline)
For transparency, the contents of this folder are all updates made just after the project deadline. The major change is a plotting function that actually visually plots the data similar to the python demo. 

## Preliminary Report
In this update, there is no longer a requirement to have a laptop connect to the LIDAR sensor, collect the data, then move the data onto the PYNQ board. The LIDAR sensor is interfaced with the PYNQ board directly. Although the PYNQ board does need to be connected to the internet to install the neccessary python packages (PyLidar3 and pykalman), an active internet connection is not required for normal operation.

In the Preliminary Report folder, there are two Jupyter Notebooks. "LIDAR_STABLE" is the current stable (relatively) version, in which the room is scanned, raw LIDAR data is clustered, and the raw LIDAR data and clusters are plotted. This repeats for a user-specified number of iterations. Additionally the stable notebook has an attempt at a Kalman filter. 

![](https://github.com/boonmam/CoDesign-Project/blob/main/Preliminary_Report/CLUSTER.gif)

"LIDAR_EXPERIMENTAL" has a prototype data association algorithm was quickly thrown together and needs significant debugging and refinement.

## Final
The project is finally "finished", but really, when is a project ever done. In this latest iteration, we implemented a more accurate, faster, and lighter-weight clustering algorithm using DBSCAN. There is now data association and even a Kalman filter. The data association matches clusters from the previous frame to the current frame. The data association works okay. The Kalman filter is 'working' but the parameters need adjustments for the Kalman filter to be more reliable.

### Jupyter Notebooks
+ Benchmark
Demonstrates the speed advantage of the new DBSCAN clustering algorithm vs the software benchmark. This Jupyter notebook by default imports the data from a CSV. However, for whatever reason, the software benchmark takes way too much time when reading from a CSV (28s) when compared to streaming from the sensor directly (1s).

+ LidarClusteringMultiThreading
Barebones implementation, no data association, no Kalman filter. Just connects to LiDAR sensor and clusters the points. Pretty fast, from collection to graph is in about 2s.

+ LidarClustering_DataAssoc
Has data association algorithm, will track clusters between frames. Short-term memory

+ LidarClustering_Kalman
Has a Kalman filter, will track clusters over longer periods of time. The Kalman filter is kinda inaccurate, will get most right but 2/3 really bad outliers

### Overlay
Has the DBSCAN clustering algorithm overlay (clusterOp2).

### HLS
Has the DBSCAN clustering algorithm .cpp file and a testbench. You can synthesize the clustering algorithm and run a simulation in Vitis (Board: xc7z020clg400-1).
